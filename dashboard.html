<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Federal Reserved Accounts – Dashboard</title>
  <meta name="description" content="User Dashboard — Federal Reserved Accounts" />
  <link rel="icon" href="images/fra-logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --nav-bg: #071733;
      --accent: #0b66b2;
      --muted: #6b7280;
      --card-bg: rgba(255,255,255,0.92);
      --glass: rgba(255,255,255,0.86);
    }
    html,body{height:100%}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f6f9fc 0%, #eef4fb 100%);
      color:#0b1220;
      margin:0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Sidebar */
    .f-sidebar{
      background: linear-gradient(180deg,var(--nav-bg), #06213a 80%);
      color:white;
      min-height:100vh;
      padding:26px 18px;
      position:fixed;
      width:20rem;
      box-shadow: 8px 0 30px rgba(2,6,23,0.08);
      transition:transform .28s ease, box-shadow .28s ease;
    }
    .logo-row{display:flex;gap:12px;align-items:center}
    .logo-row img{width:48px;height:48px;border-radius:8px;object-fit:cover}
    .brand-title{font-weight:800;font-size:1.05rem;line-height:1}
    .brand-sub{color:rgba(255,255,255,0.85);font-size:0.85rem;margin-top:2px}
    .trustline{font-size:0.78rem;color:rgba(255,255,255,0.75);margin-top:6px}

    .nav-item{
      display:flex;align-items:center;gap:10px;padding:12px 12px;border-radius:8px;margin-top:8px;
      color:rgba(255,255,255,0.95);cursor:pointer;border-left:4px solid transparent;
      transition:background .18s ease, transform .12s ease;
    }
    .nav-item:hover{background:rgba(255,255,255,0.02); transform: translateX(2px)}
    .nav-item.active{background:rgba(255,255,255,0.02);border-left-color:var(--accent);font-weight:600}

    .sidebar-footer{position:absolute;left:18px;right:18px;bottom:18px}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:10px;border-radius:8px;color:#fff;width:100%}

    /* Main content */
    .main{margin-left:20rem;padding:28px;transition:margin-left .28s ease}
    header.top{display:flex;justify-content:space-between;align-items:center;gap:20px;margin-bottom:18px}
    .pf-welcome-small{color:var(--muted);font-size:0.9rem;margin-bottom:4px}
    #pf-welcome{font-size:1.6rem;font-weight:700;color:#031127;margin:0;padding:0}
    .badge{background:#eaf3ff;color:#063b7a;padding:4px 8px;border-radius:999px;font-weight:700;font-size:0.8rem;margin-top:8px}

    /* Summary row */
    .summary-row{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:12px}
    .summary-card{background:var(--card-bg);border-radius:12px;padding:16px;box-shadow:0 8px 30px rgba(9,30,66,0.06);border:1px solid rgba(10,37,76,0.04)}
    .summary-value{font-weight:800;font-size:1.25rem;color:#03294a}
    .summary-label{font-size:0.9rem;color:var(--muted)}

    /* Accounts */
    .accounts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;margin-top:20px}
    .account-card{background:linear-gradient(180deg, rgba(255,255,255,0.98), #fff);border-radius:12px;padding:18px;border:1px solid #eef4ff;box-shadow:0 10px 30px rgba(9,30,66,0.03);display:flex;flex-direction:column;gap:12px;transition:transform .16s ease, box-shadow .16s ease}
    .account-card:hover{transform:translateY(-6px);box-shadow:0 18px 45px rgba(9,30,66,0.07)}
    .ac-top{display:flex;justify-content:space-between;align-items:start}
    .ac-type{font-weight:700;color:#052240}
    .ac-number{color:var(--muted);font-size:0.85rem}
    .ac-balance{font-weight:900;font-size:1.35rem;color:#0b3a66}

    /* Activity table */
    .activity-card{background:var(--card-bg);border-radius:12px;padding:12px;border:1px solid #eef4ff;box-shadow:0 8px 30px rgba(9,30,66,0.04);margin-top:18px}
    table.recent-activity{width:100%;border-collapse:collapse}
    table.recent-activity th, table.recent-activity td{padding:10px 8px;text-align:left;font-size:0.95rem}
    table.recent-activity th{font-weight:700;color:#032240;border-bottom:1px solid #f1f6fb}
    table.recent-activity tbody tr:hover{background:linear-gradient(90deg, rgba(11,102,178,0.03), rgba(11,102,178,0.01))}

    .muted{color:var(--muted)}
    .editor-area{width:100%;min-height:120px;border:1px solid #eef6ff;padding:10px;border-radius:10px;margin-top:6px}
    .btn-primary{background:var(--accent);color:white;padding:10px 14px;border-radius:8px;font-weight:700;border:none}
    .btn-row{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    
#changePasswordModal .modal-content {
  width: 380px;
  max-width: 90%;
  padding: 20px 24px;
  border-radius: 12px;
}

    /* Modal animations */
    @keyframes modal-show {
      0% { opacity: 0; transform: translateY(10px) scale(0.985); }
      60% { opacity: 1; transform: translateY(-6px) scale(1.005); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes overlay-fade {
      from { opacity: 0 }
      to { opacity: 1 }
    }
    .modal {
      display:none;position:fixed;inset:0;align-items:center;justify-content:center;z-index:60;
      background: rgba(2,6,23,0.55);
      -webkit-backdrop-filter: blur(3px);
      backdrop-filter: blur(3px);
    }
    .modal[aria-hidden="false"]{display:flex; animation: overlay-fade .18s ease both}
    .modal-panel{
      background:linear-gradient(180deg,#ffffff,#fbfdff);
      border-radius:12px;padding:20px;width:94%;max-width:760px;
      box-shadow:0 20px 60px rgba(2,6,23,0.35);border:1px solid rgba(3,18,40,0.04);
      transform-origin:center center;
      animation: modal-show .26s cubic-bezier(.2,.9,.3,1) both;
    }

    /* small helpers */
    .txt-small{font-size:0.9rem;color:var(--muted)}
    .w-full{width:100%}
    .mt-3{margin-top:12px}
    .hidden{display:none !important}

    @media(max-width:1024px){
      .f-sidebar{position:relative;width:100%;min-height:auto;padding:14px}.main{margin-left:0;padding:18px}.summary-row{grid-template-columns:1fr}
    }
    /* Fix safeguard buttons visibility */
.modal .btn-ghost[data-method] {
  background: #f8fafc;
  border: 1px solid #e5e7eb;
  color: #111827;
  font-weight: 500;
  transition: 0.2s;
}
.modal .btn-ghost[data-method]:hover {
  background: #e0f2fe;
  border-color: #93c5fd;
}

  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside class="f-sidebar">
    <div class="logo-row mb-6">
      <img src="images/fra-logo.png" alt="FRA logo" />
      <div>
        <div class="brand-title">Federal Reserved Accounts</div>
        <div class="brand-sub">Secure banking platform</div>
        <div class="trustline">Backed by the U.S. Treasury Department</div>
      </div>
    </div>

    <nav>
      <div id="nav-dashboard" class="nav-item active" data-target="section-dashboard">Dashboard Overview</div>
      <div id="nav-assets" class="nav-item" data-target="section-assets">Secure Asset Management</div>

      <hr class="my-4 border-white/10">

      <div id="openRequestDebit" class="nav-item">Request Secure Card</div>
      <div id="openRequestCheck" class="nav-item">Request Checkbook</div>
      <div id="openChangePassword" class="nav-item">Change Password</div>
      <div id="openContact" class="nav-item">Dedicated Support</div>
    </nav>

    <div class="sidebar-footer">
      <button id="logoutBtnSidebar" class="btn-ghost">Logout Securely</button>
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <header class="top">
      <div>
        <div class="pf-welcome-small">Welcome back</div>
        <!-- pf-welcome is populated by JS with the user's name only -->
        <h1 id="pf-welcome">—</h1>
        <div class="badge">Member — Federal Reserved Network</div>
      </div>

      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="addMoneyBtn" class="btn-primary">Initiate Deposit</button>
        </div>
        <div class="txt-small muted">Last login: <span id="lastLogin">—</span></div>
      </div>
    </header>

    <!-- Summary -->
    <div class="summary-row">
      <div class="summary-card">
        <div class="summary-label">Total Balance</div>
        <div id="totalBalance" class="summary-value">$0.00</div>
        <div class="txt-small muted">Accounts: <span id="accountCount">0</span></div>
      </div>

      <div class="summary-card">
        <div class="summary-label">Recent Activity</div>
        <div class="txt-small muted">Latest transactions — refreshed on load</div>
        <div style="margin-top:10px"><button id="viewAllActivityBtn" class="btn-ghost">View all</button></div>
      </div>

      <div class="summary-card">
        <div class="summary-label">Security</div>
        <div class="txt-small muted">2-factor authentication recommended</div>
        <div style="margin-top:10px"><button class="btn-ghost">Security settings</button></div>
      </div>
    </div>

    <!-- Accounts -->
    <section id="section-dashboard" class="mb-6">
      <h2 class="text-xl font-semibold mb-4">Accounts</h2>
      <div id="accountCards" class="accounts-grid"></div>

      <!-- Recent activity (uses transactions table) -->
      <div id="recentActivity" class="activity-card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Recent Activity</strong><div class="txt-small muted">Latest transactions for your accounts</div></div>
          <div><button id="refreshActivityBtn" class="btn-ghost">Refresh</button></div>
        </div>

        <div style="margin-top:12px" id="activityWrapper">
          <!-- Table injected by JS -->
          <p class="muted txt-small">Loading recent activity…</p>
        </div>
      </div>
    </section>

    <!-- Secure Assets -->
    <section id="section-assets" class="hidden">
      <h2 class="text-xl font-semibold mb-4">Secure Asset Management</h2>
      <p class="muted txt-small">Manage secure cards, checkbooks, and deposit instructions.</p>
      <div style="margin-top:12px">
        <button class="btn-primary mr-2" id="openSafeguardBtn">View Safeguard Methods</button>
        <button class="btn-ghost" id="openSafeguardEditorBtn">Edit Methods (Admin)</button>
      </div>
    </section>
  </main>

  <!-- Static Modals (Request Card / Checkbook / Password / Support / Editor) -->
  <div id="requestDebitModal" class="modal" aria-hidden="true">
    <div class="modal-panel">
      <h3>Request Secure Card</h3>
      <p class="muted txt-small">Enter delivery address for your secure card. We will notify you once the card ships.</p>
      <form id="debitCardForm">
        <label class="txt-small">Delivery address</label>
        <textarea id="debitAddress" class="editor-area" required></textarea>
        <div class="btn-row">
          <button type="submit" class="btn-primary">Submit</button>
          <button type="button" class="btn-ghost" data-close="requestDebitModal">Cancel</button>
          <div style="text-align:right; margin-top:10px;">
  <button class="btn-ghost" data-close>Close</button>
</div>
        </div>
        <p id="debitResult" class="txt-small muted" style="display:none;margin-top:10px"></p>
      </form>
    </div>
  </div>

  <div id="requestCheckModal" class="modal" aria-hidden="true">
    <div class="modal-panel">
      <h3>Request Checkbook</h3>
      <p class="muted txt-small">Enter delivery address for your checkbook. We will dispatch once confirmed.</p>
      <form id="checkbookForm">
        <label class="txt-small">Delivery address</label>
        <textarea id="checkbookAddress" class="editor-area" required></textarea>
        <div class="btn-row">
          <button type="submit" class="btn-primary">Submit</button>
          <button type="button" class="btn-ghost" data-close="requestCheckModal">Cancel</button>
          <div style="text-align:right; margin-top:10px;">
  <button class="btn-ghost" data-close>Close</button>
</div>
        </div>
        <p id="checkbookResult" class="txt-small muted" style="display:none;margin-top:10px"></p>
      </form>
    </div>
  </div>

  <div id="changePasswordModal" class="modal" aria-hidden="true">
    <div class="modal-panel">
      <h3>Change Password</h3>
      <p class="muted txt-small">Change your password. For demo mode this will show a confirmation only.</p>
      <form id="passwordForm">
        <label class="txt-small">Current Password</label>
        <input type="password" class="editor-area" required />
        <label class="txt-small">New Password</label>
        <input type="password" class="editor-area" required />
        <label class="txt-small">Confirm Password</label>
        <input type="password" class="editor-area" required />
        <div class="btn-row">
          <button type="submit" class="btn-primary">Apply</button>
          <button type="button" class="btn-ghost" data-close="changePasswordModal">Cancel</button>
          <div style="text-align:right; margin-top:10px;">
  <button class="btn-ghost" data-close>Close</button>
</div>
        </div>
        <p id="passwordResult" class="txt-small muted" style="display:none;margin-top:10px"></p>
      </form>
    </div>
  </div>

  <div id="safeguardModal" class="modal" aria-hidden="true">
    <div class="modal-panel">
      <h3>Safeguard Methods</h3>
      <p class="muted txt-small">Choose a deposit method and accept the NDA to view instructions.</p>
      <div id="safeguardBody" class="mt-3"></div>
      <div class="btn-row"><button class="btn-ghost" data-close="safeguardModal">Close</button></div>
    </div>
    <div style="text-align:right; margin-top:10px;">
  <button class="btn-ghost" data-close>Close</button>
</div>
  </div>

  <div id="supportModal" class="modal" aria-hidden="true">
    <div class="modal-panel">
      <h3>Dedicated Support</h3>
      <p class="muted txt-small">Call our dedicated support line or visit our support portal.</p>
      <p class="text-2xl font-bold mt-3">+1 (380) 225-0409</p>
      <p class="txt-small muted mt-2">Federal Reserved Accounts — Washington, D.C., USA</p>
      <div class="btn-row"><button class="btn-ghost" data-close="supportModal">Close</button></div>
    </div>
    <div style="text-align:right; margin-top:10px;">
  <button class="btn-ghost" data-close>Close</button>
</div>
  </div>

  <div id="safeguardEditorModal" class="modal" aria-hidden="true">
    <div class="modal-panel">
      <h3>Safeguard Instructions Editor</h3>
      <p class="muted txt-small">Admin-only editor for deposit instructions (HTML allowed).</p>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px">
        <div><label class="txt-small">Method</label>
          <select id="editorMethod" class="editor-area" style="height:44px">
            <option value="wire_transfer">Wire Transfer</option>
            <option value="crypto">Digital Asset (Crypto)</option>
            <option value="gold">Physical Asset (Gold)</option>
            <option value="cash">Certified Cash</option>
          </select>
        </div>
        <div><label class="txt-small">Title</label><input id="editorTitle" class="editor-area" style="height:44px" /></div>
        <div style="grid-column:1/-1"><label class="txt-small">Details (HTML allowed)</label><textarea id="editorDetails" class="editor-area"></textarea></div>
        <div style="grid-column:1/-1;display:flex;justify-content:flex-end;gap:8px;margin-top:6px">
          <button id="saveInstructionBtn" class="btn-primary">Save</button>
          <button type="button" class="btn-ghost" data-close="safeguardEditorModal">Close</button>
        </div>
      </div>
      <p id="editorStatus" class="txt-small muted" style="display:none;margin-top:10px"></p>
    </div>
  </div>

  <!-- Supabase & consolidated JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
  <script src="dashboard.js" defer></script>
</body>
</html>
